construction_demand = {
	if = {
		limit = {
			owner = {
				has_law = law_type:law_command_economy
			}
		}
		value = income
		multiply = 1.5 #allow more spending than income, but not too much. TODO: test and choose a better value
	}
	else = {
		owner = {
			value = investment_pool_gross_income
		}
		divide = modifier:country_private_construction_allocation_mult
	}
	divide = construction_point_price
	#set maximum usage to double the supply
	max = {
		value = 
	}
	subtract = 1
}
#price of each construction point is 10 goods
construction_point_price = {
	value = construction_good_price
	multiply = 10
}

construction_good_price = {
	value = 70 #base price of construction good
	if = {
		#make sure that construction has been calculated once before to avoid assuming construction cost is -75%
		limit = {
			game_date > 1836.1.5
		}
		multiply = {
			value = 1
			add = construction_price_multiplier
		}
	}
}

#calculate construction price multiplier based on formula: https://vic3.paradoxwikis.com/Market#Market_price
construction_price_multiplier = {
	value = 0.75
	multiply = {
		value = {
			value = construction_buy_orders_max
			market.mg:construction = {
				subtract = market_goods_sell_orders
			}
			divide = {
				value = construction_buy_orders_max
				market.mg:construction = {
					max = market_goods_sell_orders
				}
				min = 1
			}
		}
		#clamp between 1 and -1
		max = 1
		min = -1
	}
}

#calculates how many construction goods would be bought if all construction were in use
#used to stabilise construction point total with and without government construction active
construction_buy_orders_max = {
	market.mg:construction = {
		value = market_goods_buy_orders
	}
	subtract = construction_good_usage_prev
	add = construction_demand_prev
}

construction_demand_prev = {
	value = modifier:building_construction_point_converter_throughput_add
	multiply = 10
}

construction_good_usage_prev = {
	capital = {
		sg:construction = {
			value = state_goods_consumption
		}
	}
}
