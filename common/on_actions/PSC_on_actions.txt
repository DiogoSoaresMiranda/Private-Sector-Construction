set_construction = {
	effect = {
		every_country = {
			trigger_event = {
				on_action = set_construction_country
			}
		}
	}
}

set_construction_country = {
	effect = {
        if = {
            limit = {
                OR = {
                    NOT = {
                        has_variable = last_construction_run
                    }
                    game_date != var:last_construction_run
                }
            }
            save_max_construction_spending_values = yes
		    set_construction_point_demand = yes
            set_variable = {
                name = last_construction_run
                value = game_date
            }
        }
	}
}

set_construction_weekly_on_action = {
    effect = {
        set_global_variable = {
            name = added_days
            value = calculate_added_days
        }
        every_country = {
            set_local_variable = {
                name = event_day
                value = global_var:added_days
            }
            while = {
                limit = {
                    local_var:event_day <= 31
                }
                delay_event_switch = {
                    on_action_name = set_construction_country
                    num_days = local_var:event_day
                }
                change_local_variable = {
                    name = event_day
                    add = 7
                }
            }
        }
    }
}

on_monthly_pulse = {
    on_actions = {
        set_construction_weekly_on_action
    }
}